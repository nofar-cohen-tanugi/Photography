import*as e from"react";import{PrimeReactContext as r}from"primereact/api";import{useMountEffect as n,useUnmountEffect as t}from"primereact/hooks";import{classNames as o,UniqueComponentId as l,mergeProps as a,DomHandler as c}from"primereact/utils";import{ComponentBase as i,useHandleStyle as s}from"primereact/componentbase";function u(){return u=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},u.apply(this,arguments)}function p(e){if(Array.isArray(e))return e}function d(e,r){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var t,o,l,a,c=[],i=!0,s=!1;try{if(l=(n=n.call(e)).next,0===r){if(Object(n)!==n)return;i=!1}else for(;!(i=(t=l.call(n)).done)&&(c.push(t.value),c.length!==r);i=!0);}catch(e){s=!0,o=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}function f(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function m(e,r){if(e){if("string"==typeof e)return f(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,r):void 0}}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function v(e,r){return p(e)||d(e,r)||m(e,r)||h()}var b=i.extend({defaultProps:{__TYPE:"ScrollPanel",id:null,style:null,className:null,children:void 0,step:5},css:{classes:{root:function(e){return o("p-scrollpanel p-component",e.props.className)},wrapper:"p-scrollpanel-wrapper",content:"p-scrollpanel-content",barx:"p-scrollpanel-bar p-scrollpanel-bar-x",bary:"p-scrollpanel-bar p-scrollpanel-bar-y"},styles:"\n        @layer primereact {\n            .p-scrollpanel-wrapper {\n                overflow: hidden;\n                width: 100%;\n                height: 100%;\n                position: relative;\n                z-index: 1;\n                float: left;\n            }\n\n            .p-scrollpanel-content {\n                height: calc(100% + 18px);\n                width: calc(100% + 18px);\n                padding: 0 18px 18px 0;\n                position: relative;\n                overflow: auto;\n                box-sizing: border-box;\n            }\n\n            .p-scrollpanel-bar {\n                position: relative;\n                background: #c1c1c1;\n                border-radius: 3px;\n                z-index: 2;\n                cursor: pointer;\n                opacity: 0;\n                transition: opacity 0.25s linear;\n            }\n\n            .p-scrollpanel-bar-y {\n                width: 9px;\n                top: 0;\n            }\n\n            .p-scrollpanel-bar-x {\n                height: 9px;\n                bottom: 0;\n            }\n\n            .p-scrollpanel-hidden {\n                visibility: hidden;\n            }\n\n            .p-scrollpanel:hover .p-scrollpanel-bar,\n            .p-scrollpanel:active .p-scrollpanel-bar {\n                opacity: 1;\n            }\n\n            .p-scrollpanel-grabbed {\n                user-select: none;\n            }\n        }\n        "}}),g=e.forwardRef((function(o,i){var p=e.useContext(r),d=b.getProps(o,p),f=v(e.useState(d.id),2),m=f[0],h=f[1],g=v(e.useState("vertical"),2),y=g[0],w=g[1],x=b.setMetaData({props:d}),A=x.ptm,E=x.cx;s(b.css.styles,x.isUnstyled,{name:"scrollpanel"});var C=e.useRef(null),L=e.useRef(null),R=e.useRef(null),S=e.useRef(null),D=v(e.useState(0),2),T=D[0],z=D[1],F=v(e.useState(0),2),N=F[0],H=F[1],I=e.useRef(!1),O=e.useRef(!1),j=e.useRef(null),M=e.useRef(null),P=e.useRef(null),k=e.useRef(null),B=e.useRef(null),U=e.useRef(!1),W=e.useRef(null),Y=m+"_content",K=function(){var e=L.current.scrollWidth,r=-1*(C.current.clientHeight-R.current.clientHeight);P.current=L.current.clientWidth/e;var n=L.current.scrollHeight,t=-1*(C.current.clientWidth-S.current.clientWidth);k.current=L.current.clientHeight/n,B.current=window.requestAnimationFrame((function(){P.current>=1?c.addClass(R.current,"p-scrollpanel-hidden"):(c.removeClass(R.current,"p-scrollpanel-hidden"),R.current.style.cssText="width:"+Math.max(100*P.current,10)+"%; left:"+L.current.scrollLeft/e*100+"%;bottom:"+r+"px;"),k.current>=1?c.addClass(S.current,"p-scrollpanel-hidden"):(c.removeClass(S.current,"p-scrollpanel-hidden"),S.current.style.cssText="height:"+Math.max(100*k.current,10)+"%; top: calc("+L.current.scrollTop/n*100+"% - "+R.current.clientHeight+"px);right:"+t+"px;")}))},X=function(e){R.current.isSameNode(e.target)?w("horizontal"):S.current.isSameNode(e.target)&&w("vertical")},q=function(){"horizontal"===y&&w("vertical")},_=function(e){I.current?$(e):(O.current||$(e),G(e))},$=function(e){var r=e.pageX-j.current;j.current=e.pageX,B.current=window.requestAnimationFrame((function(){L.current.scrollLeft+=r/P.current}))},G=function(e){var r=e.pageY-M.current;M.current=e.pageY,B.current=window.requestAnimationFrame((function(){L.current.scrollTop+=r/k.current}))},J=function e(r){c.removeClass(S.current,"p-scrollpanel-grabbed"),c.removeClass(R.current,"p-scrollpanel-grabbed"),c.removeClass(document.body,"p-scrollpanel-grabbed"),document.removeEventListener("mousemove",_),document.removeEventListener("mouseup",e),I.current=!1,O.current=!1},Q=function(e){if("vertical"===y)switch(e.code){case"ArrowDown":ee("scrollTop",d.step),e.preventDefault();break;case"ArrowUp":ee("scrollTop",-1*d.step),e.preventDefault();break;case"ArrowLeft":case"ArrowRight":e.preventDefault()}else if("horizontal"===y)switch(e.code){case"ArrowRight":ee("scrollLeft",d.step),e.preventDefault();break;case"ArrowLeft":ee("scrollLeft",-1*d.step),e.preventDefault();break;case"ArrowDown":case"ArrowUp":e.preventDefault()}},V=function(){re()},Z=function(e,r){L.current[e]+=r,K()},ee=function(e,r){re(),W.current=setTimeout((function(){Z(e,r)}),40)},re=function(){W.current&&clearTimeout(W.current)},ne=function(){K()};n((function(){var e,r,n;d.id||h(l()),K(),window.addEventListener("resize",K),e=getComputedStyle(C.current),r=getComputedStyle(R.current),n=c.getHeight(C.current)-parseInt(r.height,10),"none"!==e["max-height"]&&0===n&&(C.current.style.height=L.current.offsetHeight+parseInt(r.height,10)>parseInt(e["max-height"],10)?e["max-height"]:L.current.offsetHeight+parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)+parseFloat(e.borderTopWidth)+parseFloat(e.borderBottomWidth)+"px"),U.current=!0})),t((function(){U.current&&window.removeEventListener("resize",K),B.current&&window.cancelAnimationFrame(B.current)})),e.useImperativeHandle(i,(function(){return{props:d,refresh:ne,getElement:function(){return C.current},getContent:function(){return L.current},getXBar:function(){return R.current},getYBar:function(){return S.current}}}));var te=a({id:d.id,ref:C,style:d.style,className:E("root")},b.getOtherProps(d),A("root")),oe=a({className:E("wrapper")},A("wrapper")),le=a({className:E("content"),onScroll:function(e){T!==e.target.scrollLeft?(z(e.target.scrollLeft),w("horizontal")):N!==e.target.scrollTop&&(H(e.target.scrollTop),w("vertical")),K()},onMouseEnter:K},A("content")),ae=a({ref:R,role:"scrollbar",className:E("barx"),tabIndex:0,"aria-valuenow":N,"aria-controls":Y,"aria-orientation":"horizontal",onFocus:X,onBlur:q,onKeyDown:Q,onKeyUp:V,onMouseDown:function(e){I.current=!0,j.current=e.pageX,c.addClass(R.current,"p-scrollpanel-grabbed"),c.addClass(document.body,"p-scrollpanel-grabbed"),document.addEventListener("mousemove",_),document.addEventListener("mouseup",J),e.preventDefault()}},A("barx")),ce=a({ref:S,role:"scrollbar",className:E("bary"),tabIndex:0,"aria-valuenow":T,"aria-controls":Y,"aria-orientation":"vertical",onFocus:X,onBlur:q,onKeyDown:Q,onKeyUp:V,onMouseDown:function(e){O.current=!0,M.current=e.pageY,c.addClass(S.current,"p-scrollpanel-grabbed"),c.addClass(document.body,"p-scrollpanel-grabbed"),document.addEventListener("mousemove",_),document.addEventListener("mouseup",J),e.preventDefault()}},A("bary"));return e.createElement("div",te,e.createElement("div",oe,e.createElement("div",u({ref:L},le),d.children)),e.createElement("div",ae),e.createElement("div",ce))}));g.displayName="ScrollPanel";export{g as ScrollPanel};
